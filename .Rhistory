size = 1) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors) +
labs(
x = expression("Max hourly windspeed (m/s)"),
y = expression("Predicted Daytime Max Temp (°C)"),
color = "Midshield",
fill = "Midshield"
)  +
theme_classic() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16)
)
# ------- Combine and Adjust Layout -------- #
# Note: Using patchwork (+) to combine
figure_3 <- (plot_C + plot_D) +
plot_annotation(tag_levels = 'A') & # Automatically adds A and B tags
theme(plot.tag = element_text(size = 20, face = "bold", family = "Arial"))
figure_3
plot_D =microclimate_shield_date_day %>%
data_grid(
wind_scaled = seq_range(wind_scaled, n = 101),
rad_scaled = 0,
midshield_binomial = c(0, 1)
) %>%
add_epred_draws(m_day_date_95, re_formula = NA) %>%
mutate(
# Back-transform windspeed
windspeed_ms = wind_scaled * wind_sd + wind_mean,
midshield_binomial = factor(
midshield_binomial,
levels = c(0, 1),
labels = c("absent", "present")
)
) %>%
ggplot(aes(x = windspeed_ms,
y = .epred,
color = midshield_binomial,
fill = midshield_binomial)) +
geom_point(data = microclimate_shield_date_day %>%
mutate(
temp_C = max_T2_95,
midshield_binomial = factor(
midshield_binomial,
levels = c(0, 1),
labels = c("absent", "present")
)
),
aes(x = max_windspeed,
y = temp_C,
color = midshield_binomial),
alpha = 0.05,
inherit.aes = FALSE) +
stat_lineribbon(.width = 0.95,
alpha = 0.5,
size = 1) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors) +
labs(
x = expression("Max hourly windspeed (m/s)"),
y = expression("Predicted Daytime Max Temp (°C)"),
color = "Midshield",
fill = "Midshield"
)  +
theme_classic() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16),
legend.title = element_text(family = "Arial", size = 16)
)
# ------- Combine and Adjust Layout -------- #
# Note: Using patchwork (+) to combine
figure_3 <- (plot_C + plot_D) +
plot_annotation(tag_levels = 'A') & # Automatically adds A and B tags
theme(plot.tag = element_text(size = 20, face = "bold", family = "Arial"))
figure_3
# Save to file
ggsave(file.path(data_path, "figure_3"), figure_3, width = 16, height = 12, dpi = 300, device = cairo_pdf)
wind_night_mean <- mean(microclimate_shield_date_night$max_windspeed, na.rm = TRUE)
wind_night_sd   <- sd(microclimate_shield_date_night$max_windspeed, na.rm = TRUE)
figure_4 = microclimate_shield_date_night %>%
data_grid(
wind_scaled = seq_range(wind_scaled, n = 101),
midshield_binomial = c(0, 1)
) %>%
add_epred_draws(m_night_date_05, re_formula = NA) %>%
mutate(
# Back-transform windspeed
windspeed_ms = wind_scaled * wind_night_sd + wind_night_mean,
midshield_binomial = factor(
midshield_binomial,
levels = c(0, 1),
labels = c("absent", "present")
)
) %>%
ggplot(aes(x = windspeed_ms,
y = .epred,
color = midshield_binomial,
fill = midshield_binomial)) +
geom_point(data = microclimate_shield_date_night %>%
mutate(
temp_C = min_T2_05,
midshield_binomial = factor(
midshield_binomial,
levels = c(0, 1),
labels = c("absent", "present")
)
),
aes(x = max_windspeed,
y = temp_C,
color = midshield_binomial),
alpha = 0.05,
inherit.aes = FALSE) +
stat_lineribbon(.width = 0.95,
alpha = 0.5,
size = 1) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors) +
coord_cartesian(ylim = c(10, 25)) +  # Focuses the y-axis between 10 and 25 degrees
labs(
x = expression("Max hourly windspeed (m/s)"),
y = expression("Predicted Night-time Min Temp (°C)"),
color = "Midshield",
fill = "Midshield"
) +
theme_classic() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16),
legend.title = element_text(family = "Arial", size = 16)
)
figure_4
# Save to file
ggsave(file.path(data_path, "figure_4.pdf"), figure_4, width = 12, height = 12, dpi = 300, device = cairo_pdf)
# ------- Supplement figure: temp Time Series -------- #
Plot_S1 <- ggplot(microclimate_shield_date_day, aes(x = Date, y = max_T2, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", size = 1, alpha = 0.7, aes(group = midshield)) +
labs(y = "Max daily temp (°C) at 1 cm (06:00 - 21:00)") +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.position = "none"
) +
scale_x_date(breaks = scales::date_breaks("3 days"),
labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# ------- Nighttime Time Series -------- #
Plot_S2 <- ggplot(microclimate_shield_date_night, aes(x = Date, y = min_T2_05, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", size = 1, alpha = 0.7, aes(group = midshield)) +
labs(x = "Date", y = "Min daily temp (°C) at 1 cm (21:00 - 06:00)") +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, family = "Arial", size = 16),
axis.title.x = element_text(family = "Arial", size = 16, margin = margin(t = 10)),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.position = "none"
) +
scale_x_date(breaks = scales::date_breaks("3 days"),
labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# ------- Combine and Adjust Layout -------- #
supplement_plot1 <- (Plot_S1 + Plot_S2) +
theme(plot.tag = element_text(size = 20, face = "bold"),
plot.tag.position = c(0, 1.1))  # More space between tag and plot
supplement_plot1
# ------- Supplement figure: temp Time Series -------- #
# Ensure Date class
microclimate_shield_date_day$Date <- as.Date(microclimate_shield_date_day$Date)
microclimate_shield_date_night$Date <- as.Date(microclimate_shield_date_night$Date)
# Plot S1
Plot_S1 <- ggplot(microclimate_shield_date_day, aes(x = Date, y = max_T2, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(y = "Max daily temp (°C) at 1 cm") +
theme_minimal() +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# Plot S2
Plot_S2 <- ggplot(microclimate_shield_date_night, aes(x = Date, y = min_T2_05, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(x = "Date", y = "Min daily temp (°C) at 1 cm") +
theme_minimal() +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# ------- Combine and Adjust Layout -------- #
supplement_plot1 <- (Plot_S1 + Plot_S2) +
theme(plot.tag = element_text(size = 20, face = "bold"),
plot.tag.position = c(0, 1.1))  # More space between tag and plot
supplement_plot1
# Plot S1
Plot_S1 <- ggplot(microclimate_shield_date_day, aes(x = Date, y = max_T2, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(y = "Max daily temp (°C) at 1 cm") +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16),
legend.title = element_text(family = "Arial", size = 16)
) +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# Plot S2
Plot_S2 <- ggplot(microclimate_shield_date_night, aes(x = Date, y = min_T2_05, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(x = "Date", y = "Min daily temp (°C) at 1 cm") +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16),
legend.title = element_text(family = "Arial", size = 16)
) +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# ------- Combine and Adjust Layout -------- #
supplement_plot1 <- (Plot_S1 + Plot_S2) +
plot_annotation(tag_levels = 'A') & # Automatically adds A and B tags
theme(plot.tag = element_text(size = 20, face = "bold"),
plot.tag.position = c(0, 1.1))  # More space between tag and plot
supplement_plot1
# Plot S1
Plot_S1 <- ggplot(microclimate_shield_date_day, aes(x = Date, y = max_T2, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(y = "Max daily temp (°C) at 1 cm") +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.position = "none"
) +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# Plot S2
Plot_S2 <- ggplot(microclimate_shield_date_night, aes(x = Date, y = min_T2_05, color = midshield, fill = midshield)) +
stat_summary(fun = mean, geom = "point", size = 4, shape = 16) +
stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.3) +
stat_summary(fun = mean, geom = "line", linewidth = 1, alpha = 0.7, aes(group = midshield)) + # Changed size to linewidth
labs(x = "Date", y = "Min daily temp (°C) at 1 cm") +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 16),
axis.text.y = element_text(family = "Arial", size = 16),
axis.title.y = element_text(family = "Arial", size = 16, margin = margin(r = 10)),
legend.text = element_text(family = "Arial", size = 16),
legend.title = element_text(family = "Arial", size = 16)
) +
scale_x_date(breaks = scales::date_breaks("3 days"), labels = scales::date_format("%b %d")) +
scale_color_manual(values = shield_colors) +
scale_fill_manual(values = shield_colors)
# ------- Combine and Adjust Layout -------- #
supplement_plot1 <- (Plot_S1 + Plot_S2) +
plot_annotation(tag_levels = 'A') & # Automatically adds A and B tags
theme(plot.tag = element_text(size = 20, face = "bold"),
plot.tag.position = c(0, 1.1))  # More space between tag and plot
supplement_plot1
# Save to file
ggsave(file.path(data_path, "supplement_plot1.pdf"), supplement_plot1, width = 16, height = 12, dpi = 300, device = cairo_pdf)
head(microclimate_shield_date_day)
# Calculate scaling factor
scale_factor <- max(microclimate_shield_date_day$max_windspeed, na.rm = TRUE) /
max(microclimate_shield_date_day$radiation, na.rm = TRUE)
# Optional: custom function for mean ± CI (if not already defined)
mean_cl_normal <- function(x, conf.int = 0.95) {
m <- mean(x, na.rm = TRUE)
se <- sd(x, na.rm = TRUE) / sqrt(length(na.omit(x)))
error <- qt(conf.int/2 + .5, df = length(na.omit(x)) - 1) * se
data.frame(y = m, ymin = m - error, ymax = m + error)
}
# Create plot
Plot_dual <- ggplot(microclimate_shield_date_day, aes(x = Date)) +
# WIND SPEED (primary axis)
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "point",
size = 3,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun.data = mean_cl_normal,
geom = "errorbar",
width = 0.2,
color = "steelblue") +
# RADIATION (scaled to wind axis)
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "orange") +
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "point",
size = 3,
color = "orange") +
# Dual axis
scale_y_continuous(
name = "Max wind speed (m/s)",
sec.axis = sec_axis(~ . / scale_factor,
name = "Radiation (J/cm2)")
) +
scale_x_date(
breaks = date_breaks("3 days"),
labels = date_format("%b %d")
) +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 14),
axis.text.y = element_text(size = 14),
axis.title.y.left = element_text(color = "steelblue", size = 16, margin = margin(r = 10)),
axis.title.y.right = element_text(color = "orange", size = 16, margin = margin(l = 10))
)
Plot_dual
library(scales)
# Calculate scaling factor
scale_factor <- max(microclimate_shield_date_day$max_windspeed, na.rm = TRUE) /
max(microclimate_shield_date_day$radiation, na.rm = TRUE)
# Optional: custom function for mean ± CI (if not already defined)
mean_cl_normal <- function(x, conf.int = 0.95) {
m <- mean(x, na.rm = TRUE)
se <- sd(x, na.rm = TRUE) / sqrt(length(na.omit(x)))
error <- qt(conf.int/2 + .5, df = length(na.omit(x)) - 1) * se
data.frame(y = m, ymin = m - error, ymax = m + error)
}
# Create plot
Plot_dual <- ggplot(microclimate_shield_date_day, aes(x = Date)) +
# WIND SPEED (primary axis)
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "point",
size = 3,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun.data = mean_cl_normal,
geom = "errorbar",
width = 0.2,
color = "steelblue") +
# RADIATION (scaled to wind axis)
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "orange") +
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "point",
size = 3,
color = "orange") +
# Dual axis
scale_y_continuous(
name = "Max wind speed (m/s)",
sec.axis = sec_axis(~ . / scale_factor,
name = "Radiation (J/cm2)")
) +
scale_x_date(
breaks = date_breaks("3 days"),
labels = date_format("%b %d")
) +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 14),
axis.text.y = element_text(size = 14),
axis.title.y.left = element_text(color = "steelblue", size = 16, margin = margin(r = 10)),
axis.title.y.right = element_text(color = "orange", size = 16, margin = margin(l = 10))
)
Plot_dual
## --- Load Packages ---
library(marginaleffects)
library(data.table)
library(broom.mixed)
library(officer)
library(flextable)
library(here)
library(fasttime)
library(lubridate)
library(tidyverse)
library(MetBrewer)
library(ggh4x)
library(ggsignif)
library(ggdist)
library(patchwork)
library(brms)
library(emmeans)
library(extrafont)
library(tidybayes)
library(modelr)
library(scales)
# Calculate scaling factor
scale_factor <- max(microclimate_shield_date_day$max_windspeed, na.rm = TRUE) /
max(microclimate_shield_date_day$radiation, na.rm = TRUE)
# Optional: custom function for mean ± CI (if not already defined)
mean_cl_normal <- function(x, conf.int = 0.95) {
m <- mean(x, na.rm = TRUE)
se <- sd(x, na.rm = TRUE) / sqrt(length(na.omit(x)))
error <- qt(conf.int/2 + .5, df = length(na.omit(x)) - 1) * se
data.frame(y = m, ymin = m - error, ymax = m + error)
}
# Create plot
Plot_dual <- ggplot(microclimate_shield_date_day, aes(x = Date)) +
# WIND SPEED (primary axis)
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun = mean,
geom = "point",
size = 3,
color = "steelblue") +
stat_summary(aes(y = max_windspeed),
fun.data = mean_cl_normal,
geom = "errorbar",
width = 0.2,
color = "steelblue") +
# RADIATION (scaled to wind axis)
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "line",
linewidth = 1.2,
color = "orange") +
stat_summary(aes(y = radiation * scale_factor),
fun = mean,
geom = "point",
size = 3,
color = "orange") +
# Dual axis
scale_y_continuous(
name = "Max wind speed (m/s)",
sec.axis = sec_axis(~ . / scale_factor,
name = "Radiation (J/cm2)")
) +
scale_x_date(
breaks = date_breaks("3 days"),
labels = date_format("%b %d")
) +
theme_minimal() +
theme(
panel.grid.major.y = element_line(color = "gray90", linewidth = 0.5),
axis.title.x = element_text(family = "Arial", size = 16),
axis.text.x = element_text(family = "Arial", size = 14),
axis.text.y = element_text(size = 14),
axis.title.y.left = element_text(color = "steelblue", size = 16, margin = margin(r = 10)),
axis.title.y.right = element_text(color = "orange", size = 16, margin = margin(l = 10))
)
Plot_dual
# Save to file
ggsave(file.path(data_path, "supplement_plot2.pdf"), Plot_dual, width = 12, height = 12, dpi = 300, device = cairo_pdf)
# Save to file
ggsave(file.path(data_path, "figure_2.pdf"), figure_2, width = 16, height = 12, dpi = 300, device = cairo_pdf)
# Save to file
ggsave(file.path(data_path, "figure_3.pdf"), figure_3, width = 16, height = 12, dpi = 300, device = cairo_pdf)
